<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>sim项目列表</title>
<link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
</head>
<body  style="margin-top: 10px;">
<div>
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<!-- 搜索功能区域 -->
		<header style="height: 100%">
			<div align="left">
				<table style="width: 100%">
					<tr>
						<td>
							<form class="form-inline" onsubmit="return false">
								<div class="form-group">
									项目:<input id="projectName" style="width: 120px;" name="projectName"  type="text"  autocomplete="off"   class="form-control" >  
									
									网络:<select name="netId"  class="form-control" id="netId"   style="height: 32px;line-height: 30px;border-width: 1px;border-style: solid;border-radius: 2px;background-color: #fff;width: 100px;">
								        <option value=""></option>
								        <option value="1">LTE</option>
								        <option value="2">WCDMA</option>
								        <option value="3">GSM</option>
								        <option value="4">5G</option>
								        <option value="5">CDMA</option>
								    </select>
									
									省份:<input id="provinceName" style="width: 120px;" name="provinceName"  type="text"  autocomplete="off"   class="form-control" >  
									城市:<input id="cityName" style="width: 120px;" name="cityName"  type="text"  autocomplete="off"   class="form-control" >  
									运营商:
									<select name="operators"  class="form-control" id="operators"   style="height: 32px;line-height: 30px;border-width: 1px;border-style: solid;border-radius: 2px;background-color: #fff;width: 100px;">
								        <option value=""></option>
								        <option value="联通">联通</option>
								        <option value="电信">电信</option>
								        <option value="移动">移动</option>
								    </select>
									
									
									<button id="searchBt" class="layui-btn layui-btn-sm  layui-btn-normal">
										<i class="layui-icon">&#xe615;</i>搜索
									</button>
									<button id="clearBt" class="layui-btn layui-btn-sm  layui-btn-danger" style="margin-left: 1px;">
										<i class="layui-icon layui-icon-delete" style="font-size: 30px; color: white-space;"></i>清空
									</button>
									
									
								</div>
							</form>
						</td>
						<td align="right">
							 
							 <button id="addBtnModel" class="layui-btn layui-btn-sm  layui-btn-normal" style="margin-left: 1px;" >
								  <i class="layui-icon layui-icon-add-1"></i>添加
							</button>
							 
							<button id="importBtnModel"  onclick="location.href='/pages/buss/simproject/import.html'" class="layui-btn layui-btn-sm  layui-btn-normal" style="margin-left: 1px;"  >
								  <i class="layui-icon layui-icon-next"></i>导入
							</button> 
							<button id="deleteBtnModel" class="layui-btn layui-btn-sm  layui-btn-danger" style="margin-left: 1px;" >
								  <i class="layui-icon">&#xe640;</i>删除
							</button>
							
						</td>
					</tr>
				</table>
			</div>
		</header>

		<div>
			<div class="widget-body no-padding">
				<!-- 列表展示区域 -->
				<table class="layui-hide" id="infolist" lay-filter="infolist"></table>
			</div>
		</div>
		
		
	</div>
</div>

	


</body>
</html>

	<script type="text/javascript" src="../../../../js/libs/jquery-2.1.1.min.js" ></script>
	<script type="text/javascript" src="../../../../layui/layui.js" ></script>
	<script type="text/javascript" src="../../../../js/jq.js"></script>
	<script type="text/javascript" src="../../../../js/common.js" charset="UTF-8"></script>

	<script type="text/javascript">
	var currData;
	var checkArray=new Array();
	layui.use([ 'layer' ,'table','jquery','common'], function() {
	  var layer = layui.layer;
	  var $=layui.$;
	  var common = layui.common;
	  
	  var table = layui.table;
	  var tableIns=table.render({
	    elem: '#infolist'    
	    ,id:'infolist'
	    ,url:'/buss/sim/project/query'  
	    ,method:'post'    
	    
	    ,where:{
			   "mapLike[project_name]":$("#projectName").val()
			   ,"mapLike[net_id]":$("#netId").val()
			   ,"mapLike[operators]":$("#operators").val()
			   ,"mapLike[city_name]":$("#cityName").val()
			   ,"mapLike[province_name]":$("#provinceName").val()
			   }
	    ,cols: [[        
	      {field:'id', width:30, title: 'ID', sort: true,type:'checkbox'}
	      ,{title: '序号',width:70,templet: '#indexTpl',align:'center'}
	      ,{field:'project_name',   width:200, title: '项目',align:'center'}
	      ,{field:'net_id',   width:200, title: '网络',align:'center',templet: '#netTpl'}
	      ,{field:'province_name',   width:200, title: '省份',align:'center'}
	      ,{field:'city_name',   width:200, title: '城市',align:'center'}
	      ,{field:'operators',   width:200, title: '运营商',align:'center'}
	      ,{field:'ihandle_url',   minWidth:200, title: '项目URL',align:'center'}
	      ,{title:'操作', toolbar: '#editBtnBar', width:100,align:'center', fixed: 'right'}
	    ]]
	    ,page: true
	    ,limit:10
	    ,limits:[10,20,50,100,200,500,1000,2000,20000] 
        ,loading:true
        ,text: {
            none: '无数据' 
        }
	    ,done: function(res, curr, count){
	    	//layer.tips('搜索条件改变之后务必重新搜索', '#clearBt',{time:5000});
	    	currData=res.data;
	    	
	    	//记忆选中的checkbox
	    	for(var i=0;i<res.data.length;i++){
                for(var j=0;j<checkArray.length;j++){
                    if(res.data[i].id==checkArray[j]){
                        res.data[i]["LAY_CHECKED"]='true';
                        var index= res.data[i]['LAY_TABLE_INDEX'];
                        $('.layui-table tr[data-index=' + index + '] input[type="checkbox"]').prop('checked', true);
                        $('.layui-table tr[data-index=' + index + '] input[type="checkbox"]').next().addClass('layui-form-checked');
                    }
                }
            }
            //设置全选checkbox的选中状态
            var checkStatus = table.checkStatus('infolist');
            console.info(checkStatus);
            if(checkStatus.isAll){
                $('.layui-table-header th[data-field="id"] input[type="checkbox"]').prop('checked', true);
                $('.layui-table-header th[data-field="id"] input[type="checkbox"]').next().addClass('layui-form-checked');
            }
	    }
        ,height:'full'
        ,cellMinWidth: 80
		,size: 'sm'  
	  });
	  
	  /**添加*/
	  $("#addBtnModel").click(function(){//添加
		  common.openEditDialog(fresh,"添加项目","pages/buss/simproject/add.html","900px","420px",false,"确定","取消","/buss/sim/project/add");
	  });
	 
	  
	  //监听行工具事件  操作对应
	  table.on('tool(infolist)', function(obj){
	    var row = obj.data;
	    if(obj.event === 'del'){//单行删除
	    	
	    } else if(obj.event === 'edit'){//编辑
		    common.openEditDialog(fresh,"编辑","pages/buss/simproject/edit.html?id="+row.id,"900px","420px",false,"确定","取消","/buss/sim/project/edit");
	    }
	  });
	  
	
	  
	  /**搜索*/
	  $("#searchBt").click(function(){
		  fresh();
	  });
	  
	  /**多项删除*/
	  $("#deleteBtnModel").click(function(){
		  if(checkArray && checkArray.length>0){
		  	  common.getConfirmDelDialog("确定要删除吗？",'共删除【'+checkArray.length+'】条记录',2,"/buss/sim/project/delete",{"ids":checkArray.join(",")},fresh);
		  	if(checkArray){
	    		checkArray.length=0;
	    	}
		  }else{
			  layer.msg('未选中要删除的记录');
		  }
		  
	  });
	  
	  //currData  checkArray  监听checkbox  选中取消事件
	  table.on('checkbox', function(obj){
		 var checkStatus = table.checkStatus('infolist');
		 var rows=checkStatus.data;
		  if(obj.checked==true){//选中事件
			  var nowCheckArray=new Array();
			  for(var i=0;i<rows.length;i++){//处理选中
	 				 if($.inArray(rows[i].id,checkArray)<0){
	 					checkArray.push(rows[i].id);
	 				 }
	 				nowCheckArray.push(rows[i].id);
				  }
	 			 if(currData.length>0){//处理当前页的所有数据
	 				for(var i=0;i<currData.length;i++){
	 					if($.inArray(currData[i].id,nowCheckArray)<0){
	 						if($.inArray(currData[i].id,checkArray)>=0){
	 							checkArray.splice($.inArray(currData[i].id,checkArray), 1);
	 	 	 				 }
	 	 				 }
	 				}
	 			 }
		  }else{//删除事件
			  if(rows.length==0){
				  for(var i=0;i<currData.length;i++){
 						if($.inArray(currData[i].id,checkArray)>=0){
 							checkArray.splice($.inArray(currData[i].id,checkArray), 1);
 	 	 				 }
	 				}
			  }else{
				  var nowCheckArray=new Array();
				  for(var i=0;i<rows.length;i++){//处理选中
		 				 if($.inArray(rows[i].id,checkArray)<0){
		 					checkArray.push(rows[i].id);
		 				 }
		 				nowCheckArray.push(rows[i].id);
					  }
		 			 if(currData.length>0){//处理当前页的所有数据
		 				for(var i=0;i<currData.length;i++){
		 					if($.inArray(currData[i].id,nowCheckArray)<0){
		 						if($.inArray(currData[i].id,checkArray)>=0){
		 							checkArray.splice($.inArray(currData[i].id,checkArray), 1);
		 	 	 				 }
		 	 				 }
		 				}
		 			 }
			  }
		  }
	});
	  
	  /**清空*/
	  $("#clearBt").click(function(){
		   $("#projectName").val("")
		   $("#netId").val("")
		   $("#operators").val("")
		   $("#cityName").val("")
		   $("#provinceName").val("")
		  
		  fresh();
	  });
	  
	
	  
	  
	  function fresh(){
		  table.reload('infolist'
				   ,{where:{
					   "mapLike[project_name]":$("#projectName").val()
					   ,"mapLike[net_id]":$("#netId").val()
					   ,"mapLike[operators]":$("#operators").val()
					   ,"mapLike[city_name]":$("#cityName").val()
					   ,"mapLike[province_name]":$("#provinceName").val()
					   }
				   ,page: {curr: 1}
		  		   }
		  );
	  }
	  /**只删除行 无刷新*/
	  function deleteRow(obj){
		  obj.del();
		  fresh();
	  }
	  
	  
});

</script>

<script type="text/html" id="indexTpl">
    {{d.LAY_TABLE_INDEX+1}}
</script>






<script type="text/html" id="netTpl">
	
 
{{#  
  var checkStatusFn = function(r){
	if('1'==r){
		return 'LTE';
	}
	if('2'==r){
        return 'WCDMA';
	}
	if('3'==r){
		return 'GSM';
	}
	if('4'==r){
		return '5G';
	}
	if('5'==r){
		return 'CDMA';
	}
    return '';
  }; 
}}
      
	{{#  if(d.net_id){ }}
  		{{ checkStatusFn(d.net_id) }}
	{{#  } else { }}

	{{#  } }}           	
  

</script>


<script type="text/html" id="editBtnBar">
  <a class="layui-btn layui-btn-normal layui-btn-xs " lay-event="edit">编辑</a>
</script>

