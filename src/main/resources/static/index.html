<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="format-detection" content="telephone=no">
		<title>Kaizen管理系统</title>
		<link rel="stylesheet" href="layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="css/global.css" media="all" />
		<link rel="stylesheet" href="css/font-awesome/css/font-awesome.css" media="all" />
		
	</head>

	<body>
		<div class="layui-layout layui-layout-admin" style="border-bottom: solid 5px #1aa094;">
		    <!-- 标题栏 -->
			<div class="layui-header header header-demo" >
                <div class="layui-main">
					<div class="admin-login-box">
						<a class="logo" style="left: 0;cursor: pointer;width: 300px;" >
							<span style="font-size: 22px;">Ihandle日志分析系统</span>
						</a>
						<!--  左侧导航滚动
						 <div class="admin-side-toggle" style="left: 220px;"><i class="fa fa-bars" aria-hidden="true"></i></div>  -->
					</div>
					
				    <ul class="layui-nav" pc id="topDaoHangUl">
				    
				    	<!-- 顶部导航注意这里面支支持两级 -->
						 <!--  <li class="layui-nav-item">
							<a href='javascript:;' lay-id="index_5"><i style="padding-right: 2px;" class="fa fa-envelope-o" aria-hidden="true" title="公告" unreadNotice></i>公告</a>
							 <dl class="layui-nav-child" id="childDl1">
		                         <dd><a href='javascript:;'  lay-id="-9991"  data-url="pages/menu/list.html"><i style="padding-right: 2px;" class="fa fa-envelope-o" aria-hidden="true" title="公告" unreadNotice></i>待补充信息1</a></dd> 
		                         <dd><a href='javascript:;'  lay-id="-9992" data-url="pages/menu/list.html"><i style="padding-right: 2px;" class="fa fa-envelope-o" aria-hidden="true" title="公告" unreadNotice></i>待补充信息2</a></dd> 
		                         <dd><a href='javascript:;'   lay-id="-9993" data-url="pages/menu/list.html"><i style="padding-right: 2px;" class="fa fa-envelope-o" aria-hidden="true" title="公告" unreadNotice></i>待补充信息3</a></dd> 
		                         <dd><a href='javascript:;'  lay-id="-9994" data-url="pages/menu/list.html"><i style="padding-right: 2px;" class="fa fa-envelope-o" aria-hidden="true" title="公告" unreadNotice></i>待补充信息14</a></dd> 
		                    </dl>
						   </li>   -->
						
						
				    <!--   <li class="layui-nav-item" pc>
				        <a href="javascript:;" class="admin-header-user">
	                        <img />
	                        <span></span>
	                    </a>
	                    <dl class="layui-nav-child">
	                        <dd>
	                            <a href="javascript:;" onclick="logout()"><i class="fa fa-sign-out" aria-hidden="true"></i>退出</a>
	                        </dd>
	                    </dl>
				      </li> -->
				      
				      <!--  <li class="layui-nav-item">
							<a href='javascript:;' id="nowProject" lang="" style="font-weight: bold;">切换项目</a>
							 <dl class="layui-nav-child" id="childDl">
		                        <dd><a href='javascript:;' class="clsProj"  data-url="#">待补充信息1</a></dd>
		                    </dl>
						</li>  -->
				    </ul>
			  </div>
            </div>
            <!-- 菜单 -->
			<div class="layui-side layui-bg-black" id="admin-side" style="width: 0px;">
				<div class="layui-side-scroll" id="admin-navbar-side" lay-filter="side" >
				    <ul id="menu" class="layui-nav layui-nav-tree" lay-filter="demo">
				    	
		            </ul>
				</div>
			</div>
			
			<div class="layui-body" style="bottom: 0;border-left: solid 2px #1AA094;left: 0px;" id="admin-body">
				<div class="layui-tab admin-nav-card layui-tab-brief" lay-allowClose="true" lay-filter="admin-tab">
					<ul class="layui-tab-title">
						  <li class="layui-this">
							<i class="fa fa-dashboard" aria-hidden="true"></i>
							<cite>欢迎访问</cite>
						</li>  
					</ul>
					<div class="layui-tab-content" style="min-height: 150px; padding: 5px 0 0 0;">
						<div class="layui-tab-item layui-show">
							<!-- 首页展示的功能 -->
							<iframe src="pages/dashboard.html"></iframe> 
						</div>
					</div>
				</div>
			</div>
			
			
			<div class="layui-footer footer footer-demo" id="admin-footer" style="left: 0px;">
				<div>
					<p>Ihandle日志分析系统</p>
				</div>
			</div> 
			<div class="site-tree-mobile layui-hide">
				<i class="layui-icon">&#xe602;</i>
			</div>
			<div class="site-mobile-shade"></div>
			
			<script type="text/javascript" src="layui/layui.js"></script>
			<script type="text/javascript" src="js/libs/jquery-2.1.1.min.js"></script>
			<script type="text/javascript" src="js/jq.js"></script>
			<script type="text/javascript" src="js/main.js"></script>
			
	</div>
	<input type="hidden" id="username" name="username" />
</body>
	
	<script type="text/javascript">
		$(function(){
			
			 
			 //获取用户信息
			 $.ajax({
					type : 'get',
					url : 'http://140.206.187.251:50123/users/current',
					async : false,
					success : function(data) {
						
						var html='<li class="layui-nav-item" pc><a href="javascript:;" class="admin-header-user"><img /><span></span></a><dl class="layui-nav-child"><dd><a href="javascript:;" onclick="logout()"><i class="fa fa-sign-out" aria-hidden="true"></i>退出</a></dd></dl></li>';
				    	 $("#topDaoHangUl").append(html);
						
						$(".admin-header-user span").text(data.nickname);
						username=data.username;
						var pro = window.location.protocol;
						var host = window.location.host;
						var domain = pro + "//" + host;
						
						var sex = data.sex;
						var url = data.headImgUrl;
						if(url == null || url == ""){
							if(sex == 1){
								url = "/img/avatars/sunny.png";
							} else {
								url = "/img/avatars/1.png";
							}
							
							url = domain + url;
						} else {
							url = domain + "/statics" + url;
						}
						var img = $(".admin-header-user img");
						img.attr("src", url);
					}
				});
			 
			 
			//获取资源
			 $.ajax({  
			     url:"http://140.206.187.251:50123/permissions/getPermissionsFouUserProj",  
			     type:"post", 
			     dataType:"json",
			     data:{
			    	 "username":username,
			    	 "projId":526
			     },
			     async:false,
			     success:function(data){
			    	 if(!$.isArray(data)){
			    		 location.href='/login.html';
			    		 return;
			    	 }
			    	 var menu = $("#menu");
			    	 var htmlOri=$("#topDaoHangUl").html();
			    	 var html="";
			    	 $.each(data, function(i,item){
		    			 html=html+'<li class="layui-nav-item"><a href="javascript:;" lay-id="'+item.id+'"><i style="padding-right: 2px;" aria-hidden="true" title="'+item.name+'" unreadNotice></i>'+item.name+'</a><dl class="layui-nav-child">';
		    			 //item  每一项
		    			 var arrayItem=item.child;
		    			 if(arrayItem && arrayItem.length>0){//有子项
		    				 for(var j=0;j<arrayItem.length;j++){
		    					 html = html +'<dd><a href="javascript:;"  lay-id="'+arrayItem[j].id+'"  data-url="'+arrayItem[j].href+'"><i style="padding-right: 2px;"  aria-hidden="true" title="'+arrayItem[j].name+'" unreadNotice></i>'+arrayItem[j].name+'</a></dd>';
		    				 }
		    			 }
		    			 html = html+'</dl></li>';
			          
			        });
			    	 $("#topDaoHangUl").empty();
			    	 html=html+htmlOri;
			    	 $("#topDaoHangUl").append(html);
			     }
			 });
		});
		
		
		function logout(){
			$.ajax({
				type : 'get',
				url : 'http://140.206.187.251:50123/logout',
				success : function(data) {
					localStorage.removeItem("token");
					location.href='/login.html';
				}
			});
		}
	</script>
	
</html>